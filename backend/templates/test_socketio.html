<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h2>Socket.IO Secure Chat Test</h2>
    
    <div>
        <label>JWT Token:</label><br>
        <input type="text" id="token" style="width: 500px;" placeholder="Paste your access_token here">
    </div>
    
    <div>
        <label>Community ID:</label><br>
        <input type="number" id="room" value="1">
    </div>
    
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="leaveRoom()">Leave Room</button>
    
    <div style="margin-top: 20px;">
        <input type="text" id="messageInput" placeholder="Type a message..." style="width: 300px;">
        <button onclick="sendMessage()">Send Message</button>
    </div>
    
    <div id="messages" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll;">
        <p><em>Messages will appear here...</em></p>
    </div>

    <script>
        let socket = null;

        function connectSocket() {
            socket = io('http://localhost:5000');
            
            socket.on('connect', () => {
                addMessage('âœ… Connected to server');
            });

            socket.on('receive_message', (data) => {
                addMessage(`${data.username}: ${data.content}`);
            });

            socket.on('user_joined', (data) => {
                addMessage(`ğŸŸ¢ ${data.message}`, 'green');
            });

            socket.on('user_left', (data) => {
                addMessage(`ğŸ”´ ${data.message}`, 'red');
            });

            socket.on('error', (data) => {
                addMessage(`âŒ Error: ${data.message}`, 'red');
            });

            socket.on('disconnect', () => {
                addMessage('ğŸ”´ Disconnected from server', 'orange');
            });
        }

        function joinRoom() {
            const token = document.getElementById('token').value;
            const room = document.getElementById('room').value;

            if (!token) {
                alert('Please enter your JWT token');
                return;
            }

            if (!socket) {
                connectSocket();
            }

            socket.emit('join_room', { token, room });
        }

        function leaveRoom() {
            const token = document.getElementById('token').value;
            const room = document.getElementById('room').value;

            if (socket) {
                socket.emit('leave_room', { token, room });
            }
        }

        function sendMessage() {
            const token = document.getElementById('token').value;
            const room = document.getElementById('room').value;
            const message = document.getElementById('messageInput').value;

            if (!message.trim()) {
                alert('Message cannot be empty');
                return;
            }

            if (socket) {
                socket.emit('send_message', { token, room, message });
                document.getElementById('messageInput').value = '';
            } else {
                alert('Please join a room first');
            }
        }

        function addMessage(text, color = 'black') {
            const div = document.createElement('div');
            div.style.color = color;
            div.textContent = text;
            document.getElementById('messages').appendChild(div);
        }

        // Allow Enter key to send message
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
